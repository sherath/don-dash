sudo: required
services:
- docker
before_install:
- docker build -t $DOCKER_IMAGE .
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker push $DOCKER_IMAGE
script:
- docker run -it --rm $DOCKER_IMAGE py.test
- docker run -it --rm -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_KEY=$HALO_AGENT_KEY
  -e SERVER_GROUP=$SERVER_GROUP $DOCKER_IMAGE /app/scan_with_halo.sh
env:
  global:
  - SERVER_GROUP=PCI
  - HALO_API_HOSTNAME=api.cloudpassage.com
  - HALO_API_PORT=443
  - DOCKER_IMAGE="sherath/don-dash:latest"
  - secure: WHy+asdgpZouRRJz71GJfFmaquRAkQbKUkxr5awG3Vhu7uZuiKcxNQHDBzHAan/Z0Q/+LsiUtfeeM+H7sI69j+RZzt5k4Fphb+lDX7+amAKbztLk8dF9Zp2Dv7U91kTRjHTWTdngTyYeuO0rT8povgWYLYKfTa4Xih5ih4IRR8e4EUJh0Upx5j9WbnGpH6eqmR+rzHTi4Znv+KmK2vcorK13XOIs/G+cuT8Wh8vjXLW8i3GO/OaG4A2MLKWJM/dQyAqJ7G016SMVIGcwjDlovGOLzm6RG8ZZ7PTDX5xbNVMRkUY2Jh/7PLGViSIcOUUnhV0HTuNTwy6UXYpDeAV4t/ceZFTBwxKvVleViV5MAPPIeqjbXrC19t+jVCZUZiBXRv09V8IM+GaGfa5+NP8wkDhuC/KdNAUCMYnNG65HWE0A1C7WU1fOR9orL0+r9P/wxilA9wASg3bwzG57jrxRrV9vUMYiOgjjq5Z2myiBwEp9if4OqZx/Txj1eftqqIYeMpRFeV7G4mGK6t1MBJO4ivrnN/Y5E/eCvBNbFK+871k6qIu7mP3HuEPvg5ds86B/NdEIa3TVTvMZ+tvJFsMfafuw4bbDKe1VXN/1PUl2i53UO7z2z9agEPGzbHgiaCtXHKcO4qbGfGUcHIkDt2ndXohsyWA6SZQGwfUJTIr/8HU=
  - secure: b8Co66hH9H+wHz4eyD3HP1vFyoVJg4JOApCxF4zhA3PJhnOfl5RxIUvFtrxCnGH7NSSnhDrCKwALhFR7ooRjlE/pynlh/U53O8T06bYdDwXndJ/adJcjeyinoTkqTcz+GeUCAyytBnnzoTcK9efxCM16J+bWRG7ybX2Oyxi77NROu4mZuZq3jHoiWmay8nd6joqV9cueJ8hKkhyOwTxKSioyvrkfSZ0PAsH2pujOHz3RxgnVARIsBRqEiIBNVcWbQ9UCZCOcB0/uziJ2TmtIL7bwh+vKL3OCLAlgyEdS8Mtm91uKyOwuCyrafOVYySNwdw2uNKje5BSCG8e91TcsxlyYcpC20PpsUNMtrO5w+ITDVXMBVsNoJSnXAl7Js502ufVV2etUGgI5zoiAPS+x2B5qehLX8n8n9ETcgrBwrUAOAxBggZE76prynqlYKrceWmYPR4m/MCTUdN9bEiP3pJ9RNXEPv4YDf1G2X89Rt2TfNd/YJ/2PiVbUJWxntAWvNS9QV0z6lDan8vuHc7jctcTJP0QiILbNacYwOewWsLl+3631rMXakeTEeYi/LQNyotUYZjv4Iko0xYuwkJt1KU53uSCrnZ4rbS0z8/eHDbziAKe4YSfa/oEVcKJYkJKskI5gySc3HFU0fK1osQVNhNr2J7O4a9A2/97kcixwdW4=
  - secure: q+8uIPAGUa8X6sa9SlEsVhgy1lkfhNyyh0I6r8Akv9DWlgZUW1YRqj7LEoAbeEB387BwqSxcA1WKF332QofQwStgSNYPMlWR6CV+4FCSLZu76+BfDvFl33SpW2xMZRXueQGyZVFDDW60j/w+lS2BLB3VT4PdJP/U+PP9a/wTj2CA1BONTpxG3msp3ZQZsRsMj5EbV4TdnZ9MtftCF4cR99JlzokmIHd9I3lgatMGvPDt7OtzofldLUNdkWz7P8Op+Atz83idchUHmqKZd+zfZcH+0BOuT7GQqpnXQ/HluuwJUTXErrf0j2jZwlImv/dh7oWXX/OidxpzHR7BNM6WmXOwUXKIf1FLgjiEuqSYp1uDf10Y9AXz6AV5EMLkgvNBEJdoqkuEBmaOn9eu8u6z3wWfCNVxYbzI2bgbC/EAGud8Dy3i/COj4M6XjxEQkrZ70KkIvRfRSMQq/JyF6kI1HN4pOWP+xUhrxiKiFbqs5T0NSeqxgGFe6uJ7Isf5GatkfhKKxoPVY/C6yqFmktaS3lOdok4oqo19do8KyzhmMjWpU3NvALPLhFu6VA56Z0yIZzPn5ckL/VmYXUwLoYfHU9P6ZohO9JOhSeNzQnpOi03XHzpUgZljl+IVZyI3QBiBvMuND3MRHuG70MdyG2qnn7mBOETvQKHOdTW3856Azrg=
  - secure: JKOq0SOI7SgWHwArA1bvPPOxCV/j3Nsf6o+wp+eUgElqLbYinh5qiF7v6uT+c8m+RyhDs7ei8aXQaOycPyx6yW6e1HTePzAt44jHxhwuoLQwW3C2XNrYymNSDdt7eTQhG6uXtWGD5+P/K1jU4I+EqJXtHMJojCkdDisoaFGnTAjH2eIHCclRRKs/+Y/gOoAoB+c0HMEYAC9VAsQQFzxYz72CYLcGxILNuartXXE83OgNY6iYk7RcbLgBBoYx6Gpe7U9spv9rwDcCeOuWkeTXG0ZiG0G9Tx9YWcIsFmY7brk06foDa0RUeAZng0/WyOSoWtyC5UoHhwURfNAzEjZL6WRoMmx2C+mYeOyUeFzq/u8R+8oz7KM2nlvwnkWRmLUc1xn+P00JfCz+Qxi/3c7oE9fP3n7Jz6XlA8Kccqd6F3KqCov/QtXloCAOmlBEQRogvM0R5SFVyO4zZDX2a5gVbCiaJphevidETJA5xAEFdR62Wi4Hd36sjurB7rLW8eH4O/4z0YLGQu26wYh5zEbMsuKvDJjkIDbkl5BCkp0hxQy4tvNsDU/4GxdMHpeDC54p5KhGoj9rouB/iVqBMZpTWzKlwT6Wkk9Lrigm9yIFduJa+8rgRWDdKmGuqX4ve+WTeVM94Z0jlekAUFDt/2TApQJFEB6rVRBImWI0ZObf9gg=
  - secure: GVkYh2+Kwche/pHuCsa7wl+kojz60EX0nqOqB3Mv0sApnY9ezhGmnpQK1wfYarEKC2t7Rb9qMXa+7UH3Xew789ud+7067h7mdXQaG75TVTGB7icb3mT7/2FrZ2ehuftpPjj40O/g+DsP74fZD2EWqzL2wRleSfJAkuGD1/RYgV5GFpuK2SIMGCwYB4BGYVi9baTESIH+WaVOnBLcbi6Gnkz6bwnITpqb0+sphWiYtFsYflA1GW64om0RsFHMuVdCpI/0dm+2FIaxC5w8EmWArXPiNIM60kZaiwhoYsOMGDmIGA0hae7XvuIV3eMH4LmIlf33H2gHLuYKMoTHF3zqYrZYGzboJd7LYc5A5tjiIKqiCX7MGtvUFJ1BnTHbd1KyePew8A0lReNwfAjcXq7tydpGzaIs89zFsuTNB3/zoLbQfoIzsn6MtIByIy9eMglA5v5RvHDolh+FHfqleZpGMshURlFIzrxDVaGVPvKuMdwO0WwExUeTmjhJ2Xc+rZt4LOo/57pGe9cluMVnrtj+4yTEqMcQXnmc7/PZ7gsBgjbWBhfUn24cp4WuDe4HqQzwSXecxBhWiMSvf213YH65b3QmEsRaX8KOMXUrLfeB2Q1bgz94PS2c4fgp2Nlr6DaurqYzsSbexyvktaIz4lCrPiBCE3rRrCzKbtmLJ0u6Wpo=
  - secure: qqGK67j1K8pYfVqxSui9aboSFSsySZK+5xwNAO0lisGQhadFwJL7KYiY/UEe/1dz1qFG89Gst8voQi9wD9DnOC9bg3qk9k2HFpORzxJ25WWJiOM8vE+gaOhvIDn+JLyV8NTjS/dcQQH9k6ilTyb70nDeYDwpiXgbvm5X32s1Cuwm8zVFKg99eZ+AkLjAqaKKQBKodU4iB44uWpyFbof9nq05FE5QbndxpsBOOMvqAlZmtN44ReorufQqn99K/KEUDnhehqLTSW47OEuCjWZ6j+YuadH8OltGyWxLBSs2WSOgod0XIvGbzp9XN0yMeCE73oZL4Jdu/ZwViq0wp4KOU+9byivLjSPEcb2C+FZ3J1JtDGp+haLVaDM0vNG1ePUASEkQ15jGlsGmwOG6AuhGxIXJtMCwkEsr8PUxK+4jrFkmui1BsYxcGTdXtoZEuFbY8xGMevOSowq4cjs2onjKUeKj5lm0SQBioRfsB9bk5Lz838EIZq8deM7/i1bGcLuXo/Xuul+GZpGyeKA7WKBvX/nqZLNzB/hp4OmtG6HPSafVvsjNQl9hWtfTwjX7V1Epqid0D8sTx/s5v37ivvo9hjltLbWvJAXnzjTIvX5LiIN5TKyAUckKuhS2eLK6WYdWJ1t7ccp7ggb2DJDQ8HXwB+NKe0IM6QWRwGmaRSlLcAE=
