sudo: required
services:
- docker
before_install:
- docker build -t $DOCKER_IMAGE .
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker push $DOCKER_IMAGE
script:
- docker run -it --rm $DOCKER_IMAGE py.test
- docker run -it --rm -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_KEY=$HALO_AGENT_KEY
  -e SERVER_GROUP=$SERVER_GROUP $DOCKER_IMAGE /app/scan_with_halo.sh
env:
  global:
  - SERVER_GROUP=demo_group
  - HALO_API_HOSTNAME=api.cloudpassage.com
  - HALO_API_PORT=443
  - DOCKER_IMAGE="awilson/don-dash:latest"
  - secure: uVon6+s8WTLwr8Jfq0J4Pk9WXrwDEBHwj6jzioARWKCnzbij32D/8PVWINhP7ZIzFAzAfyKUxydtj9mOuUXs0uuLZ/zaB90K19rSl9LgC8g8bif0dTwdoeO87DR5Y3YnWQlWoKLdeYvFwcibG7a+OL6IMK0SycR9SZtZdZnpiT0GJllpAeMEfi5xy1iuAqAO/2uxSw2bMl5C2F8HHhGWPRqmboGVmOoFY8DMoY0wwnsCsQRtZ/YF0GgdJvPO1jmR6JqOEvZOQmJFpd4MIf5nD130azi+R1Wb04NDsBvlNjayXEnV836LeqRHpLwLt/kho9LGhRhDZAOG/mG4GAJ1zzSIqoYy6s8gPsmnUauFzMraDojivpOXq0aSuhb0aQB8Kv1rpNHWzCUNUoH7tOzd13r+/Ts3LhXCOUA4qMsubiHZ20Ae5c7EL3Mvw3Oh/QUPeBoOvWKHNkFAAFisabmgbh44JyDgtsdJaZRZZ3uBbJXCwOrOFUTa6KzQlMvJL9iao7ismldElUpYk1heLKtKt5wQPc7p7EqMqUuy8OfvLJZPDChjVVV7WGucnsue+olZJDbAZjEvnONmDKPYUCqJLdthReX3qdaljNvdhYnlLJ9wLtU/hRw1aZ6urswIdUd29sZWVDLUXMSgd+4finUsqIMJpn6ATk2d/C23zox3w9E=
  - secure: JNhnCgSZzFBGcgOUDp5AnI6+2FuFLl4fGaA0lTIOPIrNVPUooh60BpJ3jqCt3hYjvgCQpQQZHxKps/1rfV6rzitko+q9gSZmadZqD4Mcu/SJghJpvANpMeqSA3NPYPfqwWfH1ShXCQyjU8s6rjb13VOxJeAyUEYufAmk+52GEiLBiK88HfLtb5ZzMH2McBbCjFdoGaeO6r6G8riTbBBZXO9POd/Iww9QYIR6jwtM0Rx7i/8SiVnbu0D0HP4dq5T/6MlFSkxJOQ1oJ9FXLo/Hez12gFJ+OYyuxBqsDFMWAk83BytdJ6cZ72/Bspq2eIn6qUn6R9/7QzEZ/C0GgTUag3Vi1M+l6TXmP1pSLKbZWgHpvU+xV1zjDxf6dhsXgQvfRE7mtQWlz8wVGrwjo2XoQ5dIjU5glhCgMZcDsx4nV/+y1FLg6DG9XXM/5KD+N04NLm8OQCttiPoJY3pHqbZDazclcf+W9TK/6YFCXT+dk35otfTUS/rq8VPpTalrgo5o/AViS8XjdZgos8x/i8bzak1hOH3eJ3TQsV01JRMVMqKaoH7CiWI20NwmGxkvZsJ06IXJuQXstwhb/MvpV0fwofXMfl/lOuPUyrwjYVzYuWKAAO1z7rJF+BCNutFtBnIgyMSGa7C3ZwqF4bnwm3PTH/1HTqxInsouwhAntr4l9Uk=
  - secure: NYevPSyaP5KfacukL8i3psEGYyYQMpBBlYDv1Q2l/9KA55Z95kYfeNvhpxIVdkLn66HkBwUTaVOXyIqlx/APJM5Zq6bkEGjpjgw+DrR+1Rhj8bV5WTZq06z2q6rdT9JddR+3F9tonFSVhv9N7VB/OMLY8Av6npNbKTbDAxR6JliGfr1X0NqBVFOOJisgSF3IOq2YuwRxvH8bg2BOotL1IYVZ03l8fWA1UNAmZS42BrKsOHGfyXGyY2WK1kDkh+6UVQYYOtV1Dk3Nbo4OIVQnkaClRzqj6wmEPn8XnzBh/I3iDVvMNs87OtLvB4qonRec0JZk+DGs4dv/VhyG8jv60G4j583Q0or+iHk5s6M4gyjytNdnsM8RnCj5E3aEGN5PJB9C1LQtsXFHaTB5qVC6iBRTtCngYqzc0qKbCKdRmbAn+wLJLSekCNKkY3j1PwMdo3Z7uDZdWD2+dnpzIRnRcSp18Ki6DagloHlNzDUGHs3/wzA/HmuRMj7OUKabKRV255k/TH5JPbjhrk+9Typ4Cum3iYxdK1uh4+CF0ttLn34ecAyPbMJfrwRG3gNxyaBPMQFHu/0MruS1p83QnKHz7WOETqzVAMVlpVcdiF0wkp0G2m2tKkEvL6orPXDNt9MRMu9zVjRtgDXDPIqkMBxNOG7imnjEcUepim/cyaDvfL0=
  - secure: ABRdkSSFn+f3YASfYTmawYvZ31uTdljV8z+hil2WtWMkEL17+jBrcMH87Bo85zghUbFfQNhyLhj7R1bFEwGU3ej1E7fLBMb6v3XTK9UgW4UJ0Gu4cCRDtWnEkkEzbLgs4MqEdYkN9NhxciDTWw9o/cuEQSuG3DOM69W1e4LzyNj9An7J1BHkRNE9rtEBW3ZN8+qUkR0HcMSyXFcGNMHV1RAE89Unw7PGZ+S7cXWq7ZmXMjcdpuNAdnJ07fKAVhjRCNb0osccyansEazcDresOOcEV1urYLkj7fDsWsiIQCwIgOl4xlbRm3ItD172y0354EVgfbcS2GgqtBCV3azGOpVw/Z5dSJE5ePFMAbhInbYS8hqNryE8+k+5oiZ6w1EHEV5RpYhQoQi9I/33gMUra8/YsFmeXT4dwa0x+nuqBn6kDHWG+CGzCPvUlJ0OLAmO41BO6crOWcY4A6/yyftpq1zXz1Rh3fVsgs/PcIvc9+nNdD921p3M5ime+Brmo3/N3QvS+dwiMcieNV6+Iy41dVhS1i+eL5AmNB3AgynTalCMKmPEyN3gNJrIBDtaFpmTAsDb1kMptyyUzjEmvuZZ6+JhkCPnxfUjbPszjwhdg10XJL435W9Z7YpBOpyrNzhijZMbCNcxEnyfRalHYlnPqgsq6SyQqGku0UB3F6JlfPU=
  - secure: YYu3zItCKD6P6eKrFLNej83YPi9BqsPXMc3J6PaDckA8QHCiihtKZda8+qUu0q9kcRmYe1VwbFA7s/wwXa8J07yfFpWv2rDgEH4Ezkd9Upu0AN6TaF4H/RGle4dp6mOhcDaZoOBNhlG+XRGp4Xhc3vY/UZ54B4/k/i1PvyQdKetSuWMoy5Em8SLo05LlRmEGUQ+zx5mqYW8aqhqTBw8kOgBfQSuvigcKxZhrf6jQi4So4uQETZDt9U5Rf2/lQIghDQqBKmcR2ck9/TmFtCu77Ifu5XGVutxl+re/O499ikc0Atx4cdRYf4WCVCtAHjVypCR9as7R1XdbwPOdf3ZQtPUA/8PqMy79wu/8Gjma/C6R1NjsTqNG47CwYepbH4yLPekfXbOW51MrHKOxF1M7m66DrGbpQyDIpLf6k97IQ7DQQkXd8dt0wj7/LPSKk7EPRHcgdibObdcbanJvui5V5C5TxK54FwVxKNmQB8oGYDpx+GJSp6kIUcKFjwT9yVnO9MabwRb4lE+Ohgn954rTDLFvu2aIakrZqaPlWoLdofViDYcSpwefOU4S1J3p+8Qh3u683ZE/QYrens2su6VvVgS9DEHqyKmwXqEuy4gqqkMZmbQkjpCPLZvrHDz3qUhzDUL06TmepF4iHjqd8jZ0A5dNoL52D2QzDAg8YT3BJs8=
  - secure: aNi6VrY4IAxgr1sjmQUegnYckkk9qfu4o4ICLeTgGe5Uo2cCG1UspF4pOiZ0rUL6COkXgIDnvJ39hCclcL7G4bzJt2fAh9ho6b/GddWHonWy5TrS7Q7Fr3rp1K7GHuSejqjtNtnuFfK3VoL1yVp+lOaSm+NTipmIcrZ+p9SaiM30nrGdZiENiSib+1kmMz44mnaOECla2WVvfzB9LaOioAaTjkTBax7mf46qpybH6XccZCRMfOz7Em4HlN3txkBg5p4Iz4pRAX/8vgN0o/res6qAFl7ExuMT51OtMizXT/tyJHWARhHiOPk0DolZP0QLj4FTbMC8BxLN5p9B8iYZ6w6Lhrl/0txiSbNsWPgKmuXPhs3gPu5Dg4Tl45DraCFwXCjW8XuiV2bxtlSTo7Gi4b0KKig+4gq38ykHpNp8eBixW4Gfq9Gfcl4IJIHzelPV8yYtGE3Xnvsb1ffGXs4qreeJIG0Kb9wAwHKkQoyrVoLwKDJqeZEUXyVVkKh63Uj4m+fTjM+nlx13NY9K3W51co7LbP884h6l1CYSin3k+sXPeODbn4KKCWQGLZ05M22VmzulISkOlt9F1BLgc07GAmmd99QIHtyHqSxZB+8Xd9BbD0lqRC0X4LGCKCmekWd6uewdA8CakYeXMqoV9P2FF2yKp31QDno2Nnkha8W43hI=
